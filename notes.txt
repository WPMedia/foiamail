# how to send unsent drafts
from auth.auth import get_service()
from msg.compose import distribute

agency_drafts = []
service = get_service()
drafts = service.users().drafts().list(userId='me',MaxResults=2000).execute()

for draft in drafts:
     d = service.users().drafts().get(userId='me',id=draft['id']).execute()
     subject = [x for x in d['message']['payload']['headers'] if x['name'].lower() == 'subject'][0]['value']
     agency = subject.split('|')[-1].strip()
     agency_drafts.append({'agency':agency,'draft':draft})

distribute(drafts=agency_drafts,send=True)

